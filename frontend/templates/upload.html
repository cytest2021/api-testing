<!DOCTYPE html>
<html>
<head>
    <title>导入接口文档</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h3>导入Excel接口文档</h3>
        <!-- 上传表单：替换 projectId 为 projectName -->
        <form id="uploadForm" enctype="multipart/form-data" class="mt-4">
            <!-- 新增：项目名称输入框 -->
            <div class="mb-3">
                <label for="projectName" class="form-label">项目名称</label>
                <input type="text" class="form-control" id="projectName" name="project_name" required
                       placeholder="输入项目名称（如：电商系统接口测试）">
            </div>

            <!-- 保留：文件上传项 -->
            <div class="mb-3">
                <label for="excelFile" class="form-label">选择Excel文件</label>
                <input type="file" class="form-control" id="excelFile" name="file"
                       accept=".xlsx, .xls" required>
                <small class="text-muted">支持.xlsx和.xls格式，表头需包含：接口名称、URL、方法、参数名、参数类型、是否必填、数据类型</small>
            </div>

            <button type="submit" class="btn btn-primary">上传并解析</button>
        </form>

        <!-- 解析结果展示 -->
        <div id="result" class="mt-4 p-3 rounded border d-none"></div>
    </div>

    <script>
        // 处理表单提交（无需修改，自动适配新字段）
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const resultDiv = document.getElementById('result');

            try {
                const response = await fetch('/api/import-excel', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                resultDiv.className = data.result.includes('解析完成')
                    ? 'mt-4 p-3 rounded border border-success bg-success bg-opacity-10'
                    : 'mt-4 p-3 rounded border border-danger bg-danger bg-opacity-10';
                resultDiv.textContent = data.result;
                resultDiv.classList.remove('d-none');

            } catch (error) {
                resultDiv.className = 'mt-4 p-3 rounded border border-danger bg-danger bg-opacity-10';
                resultDiv.textContent = '上传失败：' + error.message;
                resultDiv.classList.remove('d-none');
            }
        });
    </script>
</body>
</html>